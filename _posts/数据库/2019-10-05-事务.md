---
layout: default
title: InnoDB事务
published: 2019-10-05
tags: [数据库]
---
**ACID**
- 原子性：整个数据库事务是不可分割的工作单位
- 一致性：事务将数据库从一种状态转变为下一种一致性状态
- 隔离性：事务提交前对其它事务不可见
- 持久性：事务一旦提交，其结果就是永久的

**事务分类**
- 扁平事务：系统崩溃时保持点丢失。可恢复到任意保持点
- 链事务：在提交一个事务时，释放不需要的数据对象，将必要的上下文隐式传给下一个要开始的事务。只能恢复到最近的保存点。
- 嵌套事务
- 分布式事务

**事务的实现**
- 隔离性：通过锁
- 原子性、持久性：redo log
- 一致性：undo log

**redo**
- 实现事务的持久性，两部分组成  
    1. 重做日志缓冲redo log buffer，易失的
    2. 重做日志文件redo log file，持久的
- 所有事务commit时，必须将该事务的所有日志写入日志文件（redo、undo）进行持久化，也可以手动设置成允许非持久化（周期性持久化）
- log block：重做日志缓存、重做日志文件都是以512字节进行存储（block）
- InnoDB在启动时，无论上次是否正常关闭，都会尝试进行恢复，从最近的检查点开始 


**undo**
- 帮助事务回滚及MVCC
- undo log和redo log记录物理日志不一样，它是逻辑日志。可以认为当delete一条记录时，undo log中会记录一条对应的insert记录，反之亦然，当update一条记录时，它记录一条对应相反的update记录。